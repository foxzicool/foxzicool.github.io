<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>生命見證卡片展示</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body{font-family:'Microsoft JhengHei',sans-serif;}
    .main{max-width:400px;margin:30px auto;}
    .card{background:#fff;border-radius:16px;box-shadow:0 2px 8px #eee;margin:14px 0;padding:18px;position:relative;}
    .year{color:#1e50a2;}
    button{padding:6px 16px;margin-top:12px;}
    .title{font-size:20px;margin:12px 0 10px 0;}
  </style>
</head>
<body>
  <div class="main">
    <h2 class="title">所有生命見證卡片</h2>
    <div id="cards"></div>
  </div>
  <script>
    function loadCards(){
      fetch("https://你的ngrok-url/get_all_cards")
        .then(r=>r.json())
        .then(cards=>{
          if(!cards.length){document.getElementById('cards').innerText="目前沒有卡片";return;}
          let html = cards.map((d,idx)=>`
            <div class="card" id="card${idx}">
              <div class="year">${d.type === 'testimony1' ? '【一年內】' : '【五年內】'}</div>
              <div style="margin:10px 0;">${d.content}</div>
              <div style="font-size:12px;color:#aaa;">${d.date}</div>
              <button onclick="downloadCard('card${idx}')">下載卡片圖片</button>
            </div>
          `).join("");
          document.getElementById('cards').innerHTML = html;
        });
    }
    function downloadCard(id){
      let node = document.getElementById(id);
      html2canvas(node,{scale:2}).then(canvas=>{
        let a = document.createElement("a");
        a.href = canvas.toDataURL();
        a.download = "life_card.png";
        a.click();
      });
    }
    loadCards();
  </script>
</body>
</html>
