<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>恩典行動：送祝福卡</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    body{font-family:'Microsoft JhengHei',sans-serif;}
    .main{max-width:350px;margin:40px auto;}
    select,textarea,button{width:100%;max-width:340px;padding:6px;margin:8px 0;}
    button{padding:8px 20px;}
  </style>
</head>
<body>
  <div class="main">
    <h2>恩典行動：送祝福卡</h2>
    <form onsubmit="sendBlessing(event)">
      <label>我要祝福誰：</label>
      <select id="target" required>
        <option value="">請選擇</option>
        <option>terry</option><option>christine</option><option>Deborah</option><option>Eddie</option><option>Erica</option>
        <option>Kevein</option><option>Lewvis</option><option>Lexie</option><option>Nico</option><option>Stella</option>
        <option>Esther</option><option>Devin</option><option>Gary</option>
      </select>
      <textarea id="blesscontent" required placeholder="寫下祝福內容"></textarea>
      <button type="submit">送出祝福卡，進入下載頁</button>
    </form>
    <p id="blessStatus"></p>
  </div>
  <script>
    let myname = localStorage.getItem('myname') || "";
    let mypw = localStorage.getItem('mypw') || "";

    function sendBlessing(e){
      e.preventDefault();
      let name = myname;
      let password = mypw;
      let target = document.getElementById('target').value;
      let content = document.getElementById('blesscontent').value;
      if(!name || !target || !content){
        document.getElementById('blessStatus').innerText = "請填齊欄位";
        return;
      }
      if(target === name){
        document.getElementById('blessStatus').innerText = "不能祝福自己";
        return;
      }
      fetch("https://8035-61-231-26-86.ngrok-free.app/submit_blessing",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name, password, target, content})
      })
      .then(r=>r.json())
      .then(data=>{
        document.getElementById('blessStatus').innerText = data.message;
        setTimeout(()=>location.href="index3.html", 1000);
      })
      .catch(()=>{document.getElementById('blessStatus').innerText="送出失敗";});
    }
  </script>
</body>
</html>
